#!/usr/bin/env ruby
# -*- encoding: utf-8 -*-

require 'rubygems'
require 'dzen'
require '../lib/comrade'

configure do |c|
  c.interval = 2
  c.output = IO.popen('dzen2 -h 1 -ta l -bg black -w 1280', 'w')
end

before_run do
  @timer = Comrade::Timer.new ARGV.join(' ').downcase
  puts 'Started at ' << DateTime.now.to_s
end

app :line do
  if @timer.elapsed?
    puts 'Stopped at ' << DateTime.now.to_s
    Process.kill('INT', $$)
  else
    line_width = (@timer.remaining_ratio * 1280).round
    "^fg(red)^r(#{line_width}x1)"
  end
end
